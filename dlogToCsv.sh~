#!/bin/bash

if [ $# -ne 1 ]; then
    echo "This script converts a default KeySight dlog file to a KeySight csv"
    echo "Output: out.csv"
    echo "Usage: "$0" filename.csv"
else
    outputFile="./out.csv"
    cp $1 $outputFile
    period=`grep -aoe "<tint>.*</tint>" $outputFile` 
    period=`echo $period | cut -d ">" -f2 | cut -d "<" -f1`
 
    time=`grep -aoe "<time>.*</time>" $outputFile` 
    time=`echo $time | cut -d ">" -f2 | cut -d "<" -f1`

    echo "Time: "$time" Period: "$period" Values: `expr $time / $period`"

    killpoint=1
#    sed -in '1,2d' $outputFile
    while read line    
    do
	isEnd=`echo $line | grep -c "</dlog>"`
	#echo "did i found \dlog?" "`echo $line | grep -c "<\\dlog>"`"
	if [ $isEnd -gt 0 ] 
	then
	    break
	fi
	killpoint=`expr $killpoint + 1`
#	echo $killpoint
    done < $outputFile

    cm="1,$killpoint""d"
    echo $cm
    sed -i $cm $outputFile
fi
